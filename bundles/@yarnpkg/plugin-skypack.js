/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-skypack",
factory: function (require) {
var plugin;plugin=(()=>{"use strict";var e={370:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});const n=require("@yarnpkg/core"),s="skypack:",o="https://cdn.skypack.dev",a="https://api.skypack.dev";function i(e){return`/${e.scope?`@${e.scope}/`:""}${e.name}`}const c=require("semver");var l=r.n(c);const p=require("@yarnpkg/fslib");const u={resolvers:[class{supportsDescriptor(e,t){return!!e.range.startsWith(s)&&!!n.TAG_REGEXP.test(e.range.slice(s.length))}supportsLocator(e,t){return!1}shouldPersistResolution(e,t){throw new Error("Unreachable")}bindDescriptor(e,t,r){return e}getResolutionDependencies(e,t){return[]}async getCandidates(e,t,r){const o=e.range.slice(s.length),c=(await n.httpUtils.get(`${a}/v1/package${i(e)}`,{jsonResponse:!0,configuration:r.project.configuration})).distTags;if("object"!=typeof c&&!c)throw new n.ReportError(n.MessageName.REMOTE_INVALID,'Skypack API returned invalid data: missing "distTags" field');if(!Object.prototype.hasOwnProperty.call(c,o))throw new n.ReportError(n.MessageName.REMOTE_NOT_FOUND,`Skypack failed to resolve tag "${o}"`);const l=c[o];return[n.structUtils.makeLocator(e,`${s}${l}`)]}async getSatisfying(e,t,r){return null}async resolve(e,t){throw new Error("Unreachable")}},class{supportsDescriptor(e,t){if(!e.range.startsWith(s))return!1;const r=e.range.slice(s.length);return n.TAG_REGEXP.test(r)||!!n.semverUtils.validRange(r)}supportsLocator(e,t){if(!e.reference.startsWith(s))return!1;const{selector:r}=n.structUtils.parseRange(e.reference);return!!l().valid(r)}shouldPersistResolution(e,t){return!0}bindDescriptor(e,t,r){return e}getResolutionDependencies(e,t){return[]}async getCandidates(e,t,r){const o=n.semverUtils.validRange(e.range.slice(s.length));if(null===o)throw new Error("Expected a valid range, got "+e.range.slice(s.length));const c=await n.httpUtils.get(`${a}/v1/package${i(e)}`,{jsonResponse:!0,configuration:r.project.configuration});return c.isDeprecated&&r.report.reportWarning(n.MessageName.DEPRECATED_PACKAGE,n.structUtils.prettyDescriptor(r.project.configuration,e)+" is deprecated"),Object.keys(c.versions).map(e=>new(l().SemVer)(e)).filter(e=>o.test(e)).sort((e,t)=>-e.compare(t)).map(t=>n.structUtils.makeLocator(e,`${s}${t.raw}`))}async getSatisfying(e,t,r){const o=n.semverUtils.validRange(e.range.slice(s.length));if(null===o)throw new Error("Expected a valid range, got "+e.range.slice(s.length));return t.map(e=>{try{return new(l().SemVer)(e.slice(s.length))}catch(e){return null}}).filter(e=>null!==e).filter(e=>o.test(e)).sort((e,t)=>-e.compare(t)).map(t=>n.structUtils.makeLocator(e,`${s}${t.raw}`))}async resolve(e,t){const{selector:r}=n.structUtils.parseRange(e.reference),s=l().clean(r);if(null===s)throw new n.ReportError(n.MessageName.RESOLVER_NOT_FOUND,"The Skypack semver resolver got selected, but the version isn't semver");return{...e,version:s,languageName:"node",linkType:n.LinkType.HARD,dependencies:new Map,peerDependencies:new Map,dependenciesMeta:new Map,peerDependenciesMeta:new Map,bin:new Map}}}],fetchers:[class{supports(e,t){return e.reference.startsWith(s)}getLocalPath(e,t){return null}async fetch(e,t){const r=t.checksums.get(e.locatorHash)||null,[s,o,a]=await t.cache.fetchPackageFromCache(e,r,{onHit:()=>t.report.reportCacheHit(e),onMiss:()=>t.report.reportCacheMiss(e,n.structUtils.prettyLocator(t.project.configuration,e)+" can't be found in the cache and will be generated with Skypack"),loader:()=>this.generate(e,t),skipIntegrityCheck:t.skipIntegrityCheck});return{packageFs:s,releaseFs:o,prefixPath:n.structUtils.getIdentVendorPath(e),checksum:a}}async generate(e,t){const{selector:r}=n.structUtils.parseRange(e.reference),s=l().clean(r);if(null===s)throw new n.ReportError(n.MessageName.RESOLVER_NOT_FOUND,"The Skypack semver resolver got selected, but the version isn't semver");let c;const u=`${a}/v1/package${i(e)}`;try{c=await n.httpUtils.get(u,{jsonResponse:!0,configuration:t.project.configuration})}catch(e){throw new n.ReportError(n.MessageName.FETCH_FAILED,"Couldn't lookup package data from "+u)}const g=`${o}${i(e)}@${s}`,d=await n.httpUtils.request(g,null,{configuration:t.project.configuration});if(200!==d.statusCode)throw new n.ReportError(n.MessageName.FETCH_FAILED,`${g} responded with code ${d.statusCode}`);const h=d.headers["x-pinned-url"];h||t.report.reportWarning(n.MessageName.REMOTE_NOT_FOUND,n.structUtils.prettyLocator(t.project.configuration,e)+" has no pinned URL available; falling back to lookup URL");const f=h?`${o}${h}`:g;return p.xfs.mktempPromise(async r=>{var o;return await Promise.all([p.xfs.writeFilePromise(p.ppath.join(r,"index.mjs"),(o=f,`export * from "${o}";\nexport {default} from "${o}";\n`)),p.xfs.writeJsonPromise(p.ppath.join(r,"package.json"),{name:e.name,version:s,type:"module",description:c.description||"",license:c.license||"",keywords:c.keywords||[],main:"index.mjs",module:"index.mjs",browser:"index.mjs",files:["index.mjs"]})]),n.tgzUtils.makeArchiveFromDirectory(r,{prefixPath:n.structUtils.getIdentVendorPath(e),compressionLevel:t.project.configuration.get("compressionLevel")})})}}]}}},t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(370)})();
return plugin;
}
};